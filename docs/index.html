<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Medication Unit Converter</title>
  <style>
    .medication-block {
      border: 2px solid black;
      padding: 16px;
      margin: 16px 0;
    }
    .unit-input {
      display: block;
      margin: 8px 0;
    }
    label {
      display: inline-block;
      width: 80px;
    }
  </style>
</head>
<body>
  <div id="container"></div>

  <script>
    async function loadConfigAndBuildUI() {
      const response = await fetch('cfg.json');
      const cfg = await response.json();
      const container = document.getElementById('container');

      for (const [drug, units] of Object.entries(cfg.conv)) {
        const block = document.createElement('div');
        block.className = 'medication-block';
        block.innerHTML = `<h2>${drug}</h2>`;

        const inputs = {};

        for (const unit of Object.keys(units)) {
          const wrapper = document.createElement('div');
          wrapper.className = 'unit-input';

          const label = document.createElement('label');
          label.textContent = unit + ':';
          label.setAttribute('for', `${drug}-${unit}`);

          const input = document.createElement('input');
          input.type = 'number';
          input.id = `${drug}-${unit}`;

          wrapper.appendChild(label);
          wrapper.appendChild(input);
          block.appendChild(wrapper);

          inputs[unit] = input;
        }

        // Hook up event listeners for all units
        for (const [unitName, inputEl] of Object.entries(inputs)) {
          inputEl.addEventListener('input', () => {
            const val = parseFloat(inputEl.value);
            if (isNaN(val)) return;

            const fromRatio = cfg.conv[drug][unitName];

            for (const [targetUnit, targetEl] of Object.entries(inputs)) {
              if (targetUnit === unitName) continue;
              const toRatio = cfg.conv[drug][targetUnit];
              const converted = (val / fromRatio) * toRatio;
              targetEl.value = converted.toFixed(4);
            }
          });
        }

        container.appendChild(block);
      }
    }

    loadConfigAndBuildUI().catch(console.error);
  </script>
</body>
</html>
